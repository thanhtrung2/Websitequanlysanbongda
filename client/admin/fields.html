<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω S√¢n - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-green-800 text-white">
      <div class="p-6">
        <h1 class="text-2xl font-bold">‚öΩ Admin Panel</h1>
      </div>
      <nav class="mt-6">
        <a href="index.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üìä</span> Dashboard
        </a>
        <a href="fields.html" class="flex items-center px-6 py-3 bg-green-700 border-l-4 border-white">
          <span class="mr-3">‚öΩ</span> Qu·∫£n l√Ω s√¢n
        </a>
        <a href="bookings.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üìÖ</span> Qu·∫£n l√Ω l·ªãch ƒë·∫∑t
        </a>
        <a href="customers.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üë•</span> Qu·∫£n l√Ω kh√°ch h√†ng
        </a>
        <a href="revenue.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üí∞</span> Qu·∫£n l√Ω t√†i ch√≠nh
        </a>
        <a href="inventory.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üì¶</span> Qu·∫£n l√Ω kho
        </a>
        <a href="promotions.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üéÅ</span> Qu·∫£n l√Ω khuy·∫øn m√£i
        </a>
        <a href="staff.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üëî</span> Qu·∫£n l√Ω nh√¢n vi√™n
        </a>
        <a href="reports.html" class="flex items-center px-6 py-3 hover:bg-green-700">
          <span class="mr-3">üìà</span> B√°o c√°o & Th·ªëng k√™
        </a>
        <a href="../index.html" class="flex items-center px-6 py-3 hover:bg-green-700 mt-4 border-t border-green-700">
          <span class="mr-3">üè†</span> V·ªÅ trang ch·ªß
        </a>
        <a href="#" onclick="logout()" class="flex items-center px-6 py-3 hover:bg-red-700">
          <span class="mr-3">üö™</span> ƒêƒÉng xu·∫•t
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto">
      <header class="bg-white shadow-sm">
        <div class="flex justify-between items-center px-8 py-4">
          <h2 class="text-2xl font-bold text-gray-800">Qu·∫£n l√Ω S√¢n B√≥ng</h2>
          <button onclick="openAddModal()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold">
            ‚ûï Th√™m s√¢n m·ªõi
          </button>
        </div>
      </header>

      <div class="p-8">
        <!-- Loading -->
        <div id="loading" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"></div>
          <p class="mt-4 text-gray-600">ƒêang t·∫£i d·ªØ li·ªáu...</p>
        </div>

        <!-- Fields Grid -->
        <div id="fieldsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6 hidden"></div>
      </div>
    </main>
  </div>

  <!-- Add/Edit Modal -->
  <div id="fieldModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b">
        <h3 id="modalTitle" class="text-2xl font-bold text-gray-800">Th√™m s√¢n m·ªõi</h3>
      </div>
      <form id="fieldForm" class="p-6 space-y-4">
        <input type="hidden" id="fieldId">
        
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">T√™n s√¢n *</label>
            <input type="text" id="fieldName" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2">Lo·∫°i s√¢n *</label>
            <select id="fieldType" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
              <option value="5vs5">S√¢n 5 ng∆∞·ªùi</option>
              <option value="7vs7">S√¢n 7 ng∆∞·ªùi</option>
              <option value="11vs11">S√¢n 11 ng∆∞·ªùi</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">ƒê·ªãa ch·ªâ *</label>
          <input type="text" id="fieldAddress" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Gi√°/gi·ªù (VNƒê) *</label>
          <input type="number" id="fieldPrice" required min="0" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Ti·ªán √≠ch (m·ªói d√≤ng 1 ti·ªán √≠ch)</label>
          <textarea id="fieldAmenities" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="ƒê√®n chi·∫øu s√°ng&#10;Ph√≤ng thay ƒë·ªì&#10;B√£i ƒë·ªó xe"></textarea>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Tr·∫°ng th√°i</label>
          <select id="fieldStatus" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            <option value="active">Ho·∫°t ƒë·ªông</option>
            <option value="maintenance">B·∫£o tr√¨</option>
            <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
          </select>
        </div>

        <div class="flex gap-4 pt-4">
          <button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-semibold">
            L∆∞u
          </button>
          <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition font-semibold">
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';
    const token = localStorage.getItem('token');
    let allFields = [];

    function logout() {
      localStorage.clear();
      window.location.href = '../index.html';
    }

    // Load all fields
    async function loadFields() {
      try {
        const response = await fetch(`${API_URL}/fields`);
        allFields = await response.json();
        
        document.getElementById('loading').classList.add('hidden');
        displayFields(allFields);
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('loading').innerHTML = '<p class="text-red-600">L·ªói t·∫£i d·ªØ li·ªáu</p>';
      }
    }

    function displayFields(fields) {
      const grid = document.getElementById('fieldsGrid');
      grid.classList.remove('hidden');
      
      const typeMap = {
        '5vs5': 'S√¢n 5 ng∆∞·ªùi',
        '7vs7': 'S√¢n 7 ng∆∞·ªùi',
        '11vs11': 'S√¢n 11 ng∆∞·ªùi'
      };

      const statusMap = {
        'active': { text: 'Ho·∫°t ƒë·ªông', color: 'bg-green-100 text-green-800' },
        'maintenance': { text: 'B·∫£o tr√¨', color: 'bg-yellow-100 text-yellow-800' },
        'inactive': { text: 'Kh√¥ng ho·∫°t ƒë·ªông', color: 'bg-red-100 text-red-800' }
      };

      grid.innerHTML = fields.map(field => `
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="h-40 bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center text-6xl">
            ‚öΩ
          </div>
          <div class="p-4">
            <h3 class="text-xl font-bold mb-2">${field.name}</h3>
            <p class="text-gray-600 text-sm mb-2">üìç ${field.location?.address || 'N/A'}</p>
            <p class="text-gray-600 text-sm mb-2">üèüÔ∏è ${typeMap[field.type]}</p>
            <p class="text-green-600 font-bold text-lg mb-3">${field.pricePerHour.toLocaleString()}ƒë/gi·ªù</p>
            <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusMap[field.status]?.color || 'bg-gray-100 text-gray-800'}">
              ${statusMap[field.status]?.text || field.status}
            </span>
            <div class="flex gap-2 mt-4">
              <button onclick="editField('${field._id}')" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">
                ‚úèÔ∏è S·ª≠a
              </button>
              <button onclick="deleteField('${field._id}', '${field.name}')" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600 transition">
                üóëÔ∏è X√≥a
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Open add modal
    function openAddModal() {
      document.getElementById('modalTitle').textContent = 'Th√™m s√¢n m·ªõi';
      document.getElementById('fieldForm').reset();
      document.getElementById('fieldId').value = '';
      document.getElementById('fieldModal').classList.remove('hidden');
    }

    // Edit field
    async function editField(id) {
      const field = allFields.find(f => f._id === id);
      if (!field) return;

      document.getElementById('modalTitle').textContent = 'Ch·ªânh s·ª≠a s√¢n';
      document.getElementById('fieldId').value = field._id;
      document.getElementById('fieldName').value = field.name;
      document.getElementById('fieldType').value = field.type;
      document.getElementById('fieldAddress').value = field.location?.address || '';
      document.getElementById('fieldPrice').value = field.pricePerHour;
      document.getElementById('fieldAmenities').value = field.amenities?.join('\n') || '';
      document.getElementById('fieldStatus').value = field.status;
      document.getElementById('fieldModal').classList.remove('hidden');
    }

    // Close modal
    function closeModal() {
      document.getElementById('fieldModal').classList.add('hidden');
    }

    // Save field
    document.getElementById('fieldForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('fieldId').value;
      const data = {
        name: document.getElementById('fieldName').value,
        type: document.getElementById('fieldType').value,
        location: {
          address: document.getElementById('fieldAddress').value,
          city: 'Tr√† Vinh'
        },
        pricePerHour: parseInt(document.getElementById('fieldPrice').value),
        amenities: document.getElementById('fieldAmenities').value.split('\n').filter(a => a.trim()),
        status: document.getElementById('fieldStatus').value
      };

      try {
        const url = id ? `${API_URL}/fields/${id}` : `${API_URL}/fields`;
        const method = id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          alert(id ? 'C·∫≠p nh·∫≠t s√¢n th√†nh c√¥ng!' : 'Th√™m s√¢n th√†nh c√¥ng!');
          closeModal();
          loadFields();
        } else {
          const error = await response.json();
          alert('L·ªói: ' + error.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('L·ªói k·∫øt n·ªëi server');
      }
    });

    // Delete field
    async function deleteField(id, name) {
      if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s√¢n "${name}"?`)) return;

      try {
        const response = await fetch(`${API_URL}/fields/${id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (response.ok) {
          alert('X√≥a s√¢n th√†nh c√¥ng!');
          loadFields();
        } else {
          const error = await response.json();
          alert('L·ªói: ' + error.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('L·ªói k·∫øt n·ªëi server');
      }
    }

    // Load on page load
    loadFields();
  </script>
</body>
</html>
