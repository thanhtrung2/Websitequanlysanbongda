<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Há»“ sÆ¡ cÃ¡ nhÃ¢n - ThÃ nh Trung M10</title>
  <link rel="stylesheet" href="../css/tailwind-fallback.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse-ring { 0% { transform: scale(0.9); opacity: 1; } 100% { transform: scale(1.2); opacity: 0; } }
    .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
    .gradient-text { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); }
    .avatar-ring { position: relative; }
    .avatar-ring::before { content: ''; position: absolute; inset: -4px; border-radius: 50%; background: linear-gradient(135deg, #22c55e, #3b82f6, #8b5cf6); animation: spin 3s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .tab-active { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-white to-green-50 min-h-screen">

  <!-- Navigation -->
  <nav class="fixed w-full bg-white/95 backdrop-blur-md shadow-lg z-50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <a href="../index.html" class="flex items-center gap-3 group">
          <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-700 rounded-xl flex items-center justify-center shadow-lg">
            <span class="text-2xl">âš½</span>
          </div>
          <div>
            <h1 class="text-xl font-bold gradient-text">ThÃ nh Trung M10</h1>
            <p class="text-xs text-gray-500">Há»“ sÆ¡ cÃ¡ nhÃ¢n</p>
          </div>
        </a>
        <div class="hidden md:flex items-center gap-6">
          <a href="../index.html" class="text-gray-600 hover:text-green-600 transition font-medium">Trang chá»§</a>
          <a href="../san-bong.html" class="text-gray-600 hover:text-green-600 transition font-medium">SÃ¢n bÃ³ng</a>
          <a href="shop.html" class="text-gray-600 hover:text-green-600 transition font-medium">Cá»­a hÃ ng</a>
          <a href="community.html" class="text-gray-600 hover:text-green-600 transition font-medium">Cá»™ng Ä‘á»“ng</a>
          <div id="userMenu"></div>
        </div>
        <button onclick="toggleMobileMenu()" class="md:hidden text-gray-700 text-2xl">â˜°</button>
      </div>
      <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 border-t pt-4">
        <div class="flex flex-col gap-3">
          <a href="../index.html" class="text-gray-600">Trang chá»§</a>
          <a href="../san-bong.html" class="text-gray-600">SÃ¢n bÃ³ng</a>
          <a href="shop.html" class="text-gray-600">Cá»­a hÃ ng</a>
          <a href="community.html" class="text-gray-600">Cá»™ng Ä‘á»“ng</a>
          <div id="mobileUserMenu" class="mt-2 pt-2 border-t"></div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Profile Header -->
  <section class="pt-24 pb-32 relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-green-500 via-emerald-600 to-teal-700"></div>
    <div class="absolute inset-0 opacity-20" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'0.3\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  </section>

  <!-- Profile Content -->
  <section class="relative -mt-24 pb-12 px-4">
    <div class="container mx-auto max-w-5xl">
      <!-- Profile Card -->
      <div class="glass rounded-3xl shadow-2xl overflow-hidden border border-white/50 mb-8">
        <div class="p-8">
          <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
            <!-- Avatar -->
            <div class="relative">
              <div class="avatar-ring">
                <div id="avatar" class="w-28 h-28 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center text-white text-5xl font-bold shadow-xl relative z-10">
                  ?
                </div>
              </div>
              <div class="absolute -bottom-2 -right-2 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white shadow-lg z-20">
                âœ“
              </div>
            </div>
            <!-- Info -->
            <div class="flex-1 text-center md:text-left">
              <h1 id="userName" class="text-3xl font-bold text-gray-800 mb-1">Äang táº£i...</h1>
              <p id="userRole" class="text-green-600 font-medium mb-3">KhÃ¡ch hÃ ng</p>
              <p id="userEmail" class="text-gray-500 flex items-center justify-center md:justify-start gap-2 mb-4">
                <span>ğŸ“§</span> <span id="profileEmail">Äang táº£i...</span>
              </p>
              <div class="flex flex-wrap gap-3 justify-center md:justify-start">
                <button onclick="openEditModal()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:shadow-lg hover:shadow-green-300 transition flex items-center gap-2">
                  <span>âœï¸</span> Chá»‰nh sá»­a
                </button>
                <button onclick="openChangePassword()" class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                  <span>ğŸ”’</span> Äá»•i máº­t kháº©u
                </button>
              </div>
            </div>
            <!-- Stats -->
            <div class="grid grid-cols-3 gap-4 md:gap-6">
              <div class="text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl">
                <p id="totalBookings" class="text-3xl font-bold text-green-600">0</p>
                <p class="text-xs text-gray-500 mt-1">Äáº·t sÃ¢n</p>
              </div>
              <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl">
                <p id="completedBookings" class="text-3xl font-bold text-blue-600">0</p>
                <p class="text-xs text-gray-500 mt-1">HoÃ n thÃ nh</p>
              </div>
              <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-amber-50 rounded-2xl">
                <p id="totalSpent" class="text-2xl font-bold text-orange-600">0Ä‘</p>
                <p class="text-xs text-gray-500 mt-1">Chi tiÃªu</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabs & Content -->
      <div class="grid lg:grid-cols-4 gap-6">
        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <div class="glass rounded-2xl shadow-xl p-4 sticky top-24">
            <nav class="space-y-2">
              <button onclick="switchTab('info')" class="tab-btn w-full text-left px-4 py-3 rounded-xl font-medium transition flex items-center gap-3 tab-active" data-tab="info">
                <span>ğŸ‘¤</span> ThÃ´ng tin cÃ¡ nhÃ¢n
              </button>
              <button onclick="switchTab('bookings')" class="tab-btn w-full text-left px-4 py-3 rounded-xl font-medium transition flex items-center gap-3 hover:bg-gray-100" data-tab="bookings">
                <span>ğŸ“…</span> Lá»‹ch sá»­ Ä‘áº·t sÃ¢n
              </button>
              <button onclick="switchTab('notifications')" class="tab-btn w-full text-left px-4 py-3 rounded-xl font-medium transition flex items-center gap-3 hover:bg-gray-100" data-tab="notifications">
                <span>ğŸ””</span> ThÃ´ng bÃ¡o
              </button>
              <hr class="my-3">
              <a href="../san-bong.html" class="w-full text-left px-4 py-3 rounded-xl font-medium transition flex items-center gap-3 hover:bg-green-50 text-green-600">
                <span>âš½</span> Äáº·t sÃ¢n má»›i
              </a>
              <button onclick="logout()" class="w-full text-left px-4 py-3 rounded-xl font-medium transition flex items-center gap-3 hover:bg-red-50 text-red-600">
                <span>ğŸšª</span> ÄÄƒng xuáº¥t
              </button>
            </nav>
          </div>
        </div>

        <!-- Main Content -->
        <div class="lg:col-span-3">
          <!-- Tab: Info -->
          <div id="tab-info" class="tab-content">
            <div class="glass rounded-2xl shadow-xl p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <span class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">ğŸ‘¤</span>
                ThÃ´ng tin cÃ¡ nhÃ¢n
              </h3>
              <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-1">
                  <label class="text-sm text-gray-500">Há» vÃ  tÃªn</label>
                  <p id="infoName" class="text-lg font-semibold text-gray-800 bg-gray-50 px-4 py-3 rounded-xl">Äang táº£i...</p>
                </div>
                <div class="space-y-1">
                  <label class="text-sm text-gray-500">Email</label>
                  <p id="infoEmail" class="text-lg font-semibold text-gray-800 bg-gray-50 px-4 py-3 rounded-xl">Äang táº£i...</p>
                </div>
                <div class="space-y-1">
                  <label class="text-sm text-gray-500">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
                  <p id="infoPhone" class="text-lg font-semibold text-gray-800 bg-gray-50 px-4 py-3 rounded-xl">Äang táº£i...</p>
                </div>
                <div class="space-y-1">
                  <label class="text-sm text-gray-500">Vai trÃ²</label>
                  <p id="infoRole" class="text-lg font-semibold text-gray-800 bg-gray-50 px-4 py-3 rounded-xl">Äang táº£i...</p>
                </div>
                <div class="space-y-1 md:col-span-2">
                  <label class="text-sm text-gray-500">NgÃ y tham gia</label>
                  <p id="infoCreatedAt" class="text-lg font-semibold text-gray-800 bg-gray-50 px-4 py-3 rounded-xl">Äang táº£i...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Bookings -->
          <div id="tab-bookings" class="tab-content hidden">
            <div class="glass rounded-2xl shadow-xl p-6">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                  <span class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">ğŸ“…</span>
                  Lá»‹ch sá»­ Ä‘áº·t sÃ¢n
                </h3>
                <div class="flex flex-wrap gap-2">
                  <button onclick="filterBookings('all')" class="filter-btn px-4 py-2 rounded-xl text-sm font-medium bg-green-500 text-white" data-filter="all">Táº¥t cáº£</button>
                  <button onclick="filterBookings('pending')" class="filter-btn px-4 py-2 rounded-xl text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="pending">Chá» xÃ¡c nháº­n</button>
                  <button onclick="filterBookings('confirmed')" class="filter-btn px-4 py-2 rounded-xl text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="confirmed">ÄÃ£ xÃ¡c nháº­n</button>
                  <button onclick="filterBookings('completed')" class="filter-btn px-4 py-2 rounded-xl text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="completed">HoÃ n thÃ nh</button>
                </div>
              </div>
              <div id="bookingHistory" class="space-y-4">
                <div class="text-center py-8 text-gray-500">Äang táº£i lá»‹ch sá»­...</div>
              </div>
            </div>
          </div>

          <!-- Tab: Notifications -->
          <div id="tab-notifications" class="tab-content hidden">
            <div class="glass rounded-2xl shadow-xl p-6">
              <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <span class="w-10 h-10 bg-yellow-100 rounded-xl flex items-center justify-center">ğŸ””</span>
                ThÃ´ng bÃ¡o
              </h3>
              <div class="space-y-3">
                <div class="p-4 bg-green-50 rounded-xl border-l-4 border-green-500">
                  <p class="font-semibold text-gray-800">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ nh Trung M10!</p>
                  <p class="text-sm text-gray-600 mt-1">Äáº·t sÃ¢n ngay Ä‘á»ƒ nháº­n Æ°u Ä‘Ã£i 20% cho láº§n Ä‘áº§u tiÃªn.</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500">
                  <p class="font-semibold text-gray-800">Khuyáº¿n mÃ£i cuá»‘i tuáº§n</p>
                  <p class="text-sm text-gray-600 mt-1">Giáº£m 15% cho táº¥t cáº£ cÃ¡c sÃ¢n vÃ o thá»© 7 vÃ  Chá»§ nháº­t.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Edit Modal -->
  <div id="editModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden">
      <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white">
        <h3 class="text-xl font-bold">âœï¸ Chá»‰nh sá»­a thÃ´ng tin</h3>
      </div>
      <form id="editForm" class="p-6 space-y-4">
        <div>
          <label class="block text-gray-700 font-semibold mb-2">Há» vÃ  tÃªn</label>
          <input type="text" id="editName" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 transition">
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-2">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input type="tel" id="editPhone" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 transition">
        </div>
        <div class="flex gap-3 pt-2">
          <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition">LÆ°u thay Ä‘á»•i</button>
          <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition">Há»§y</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Password Modal -->
  <div id="passwordModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden">
      <div class="bg-gradient-to-r from-purple-500 to-indigo-600 p-6 text-white">
        <h3 class="text-xl font-bold">ğŸ”’ Äá»•i máº­t kháº©u</h3>
      </div>
      <form id="passwordForm" class="p-6 space-y-4">
        <div>
          <label class="block text-gray-700 font-semibold mb-2">Máº­t kháº©u hiá»‡n táº¡i</label>
          <input type="password" id="currentPassword" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition">
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-2">Máº­t kháº©u má»›i</label>
          <input type="password" id="newPassword" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition">
        </div>
        <div>
          <label class="block text-gray-700 font-semibold mb-2">XÃ¡c nháº­n máº­t kháº©u má»›i</label>
          <input type="password" id="confirmPassword" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition">
        </div>
        <div class="flex gap-3 pt-2">
          <button type="submit" class="flex-1 bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition">Äá»•i máº­t kháº©u</button>
          <button type="button" onclick="closePasswordModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition">Há»§y</button>
        </div>
      </form>
    </div>
  </div>

  <div id="footer"></div>
  <script src="../js/main.js"></script>

  <script>
    const token = localStorage.getItem('token');
    if (!token) { alert('Vui lÃ²ng Ä‘Äƒng nháº­p'); window.location.href = 'login.html'; }
    
    let currentUser = null;
    let allBookings = [];
    let currentFilter = 'all';

    function logout() { localStorage.clear(); window.location.href = '../index.html'; }

    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('tab-active');
        btn.classList.add('hover:bg-gray-100');
      });
      document.getElementById('tab-' + tab).classList.remove('hidden');
      document.querySelector(`[data-tab="${tab}"]`).classList.add('tab-active');
      document.querySelector(`[data-tab="${tab}"]`).classList.remove('hover:bg-gray-100');
    }

    async function loadProfile() {
      try {
        const response = await fetch(`${API_URL}/users/profile`, { headers: { 'Authorization': `Bearer ${token}` } });
        if (!response.ok) throw new Error('KhÃ´ng thá»ƒ táº£i thÃ´ng tin');
        currentUser = await response.json();
        displayProfile(currentUser);
      } catch (error) {
        console.error('Error:', error);
        localStorage.clear();
        window.location.href = 'login.html';
      }
    }

    function displayProfile(user) {
      const initial = user.name.charAt(0).toUpperCase();
      document.getElementById('avatar').textContent = initial;
      document.getElementById('userName').textContent = user.name;
      document.getElementById('profileEmail').textContent = user.email;
      document.getElementById('infoName').textContent = user.name;
      document.getElementById('infoEmail').textContent = user.email;
      document.getElementById('infoPhone').textContent = user.phone || 'ChÆ°a cáº­p nháº­t';
      const roleMap = { 'customer': 'KhÃ¡ch hÃ ng', 'admin': 'Quáº£n trá»‹ viÃªn', 'staff': 'NhÃ¢n viÃªn' };
      const roleName = roleMap[user.role] || 'KhÃ¡ch hÃ ng';
      document.getElementById('userRole').textContent = roleName;
      document.getElementById('infoRole').textContent = roleName;
      if (user.createdAt) {
        document.getElementById('infoCreatedAt').textContent = new Date(user.createdAt).toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' });
      }
    }

    async function loadBookingHistory() {
      try {
        const response = await fetch(`${API_URL}/bookings/my-bookings`, { headers: { 'Authorization': `Bearer ${token}` } });
        if (response.ok) { allBookings = await response.json(); updateStats(); displayBookings(); }
      } catch (error) { console.error('Error:', error); }
    }

    function updateStats() {
      const total = allBookings.length;
      const completed = allBookings.filter(b => b.status === 'completed').length;
      const totalSpent = allBookings.filter(b => b.status !== 'cancelled').reduce((sum, b) => sum + b.totalPrice, 0);
      document.getElementById('totalBookings').textContent = total;
      document.getElementById('completedBookings').textContent = completed;
      document.getElementById('totalSpent').textContent = (totalSpent/1000).toFixed(0) + 'k';
    }

    function filterBookings(status) {
      currentFilter = status;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.dataset.filter === status) { btn.classList.remove('bg-gray-100', 'text-gray-600'); btn.classList.add('bg-green-500', 'text-white'); }
        else { btn.classList.remove('bg-green-500', 'text-white'); btn.classList.add('bg-gray-100', 'text-gray-600'); }
      });
      displayBookings();
    }

    function displayBookings() {
      const container = document.getElementById('bookingHistory');
      let filtered = currentFilter === 'all' ? allBookings : allBookings.filter(b => b.status === currentFilter);
      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      if (filtered.length === 0) {
        container.innerHTML = '<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“…</div><p class="text-gray-500">KhÃ´ng cÃ³ lá»‹ch Ä‘áº·t nÃ o</p></div>';
        return;
      }

      const statusConfig = {
        'pending': { text: 'Chá» xÃ¡c nháº­n', bg: 'bg-yellow-100', text_color: 'text-yellow-700', icon: 'â³' },
        'confirmed': { text: 'ÄÃ£ xÃ¡c nháº­n', bg: 'bg-green-100', text_color: 'text-green-700', icon: 'âœ…' },
        'completed': { text: 'HoÃ n thÃ nh', bg: 'bg-blue-100', text_color: 'text-blue-700', icon: 'ğŸ‰' },
        'cancelled': { text: 'ÄÃ£ há»§y', bg: 'bg-red-100', text_color: 'text-red-700', icon: 'âŒ' }
      };

      container.innerHTML = filtered.map(booking => {
        const config = statusConfig[booking.status];
        const bookingDate = new Date(booking.date);
        const canCancel = ['pending', 'confirmed'].includes(booking.status) && bookingDate > new Date();
        
        return `
          <div class="bg-white border border-gray-100 rounded-2xl p-5 hover:shadow-lg transition">
            <div class="flex flex-col sm:flex-row justify-between gap-4">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <span class="text-2xl">âš½</span>
                  <h4 class="font-bold text-lg text-gray-800">${booking.field?.name || 'SÃ¢n bÃ³ng'}</h4>
                  <span class="${config.bg} ${config.text_color} px-3 py-1 rounded-full text-xs font-semibold">${config.icon} ${config.text}</span>
                </div>
                <p class="text-gray-500 text-sm mb-3">ğŸ“ ${booking.field?.location?.address || 'TrÃ  Vinh'}</p>
                <div class="flex flex-wrap gap-4 text-sm">
                  <span class="text-gray-600">ğŸ“† ${bookingDate.toLocaleDateString('vi-VN')}</span>
                  <span class="text-gray-600">ğŸ• ${booking.startTime} - ${booking.endTime}</span>
                  <span class="font-bold text-green-600">ğŸ’° ${booking.totalPrice.toLocaleString('vi-VN')}Ä‘</span>
                </div>
              </div>
              ${canCancel ? `<button onclick="cancelBooking('${booking._id}')" class="self-start px-4 py-2 bg-red-50 text-red-600 rounded-xl hover:bg-red-100 transition text-sm font-medium">Há»§y Ä‘áº·t</button>` : ''}
            </div>
          </div>`;
      }).join('');
    }

    async function cancelBooking(bookingId) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n há»§y Ä‘áº·t sÃ¢n nÃ y?')) return;
      try {
        const response = await fetch(`${API_URL}/bookings/${bookingId}/status`, {
          method: 'PUT', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ status: 'cancelled' })
        });
        if (response.ok) { alert('ÄÃ£ há»§y Ä‘áº·t sÃ¢n!'); loadBookingHistory(); }
      } catch (error) { alert('Lá»—i káº¿t ná»‘i'); }
    }

    function openEditModal() {
      document.getElementById('editName').value = currentUser.name;
      document.getElementById('editPhone').value = currentUser.phone || '';
      document.getElementById('editModal').classList.remove('hidden');
    }
    function closeEditModal() { document.getElementById('editModal').classList.add('hidden'); }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const response = await fetch(`${API_URL}/users/profile`, {
          method: 'PUT', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ name: document.getElementById('editName').value, phone: document.getElementById('editPhone').value })
        });
        if (response.ok) { alert('Cáº­p nháº­t thÃ nh cÃ´ng!'); closeEditModal(); loadProfile(); }
      } catch (error) { alert('Lá»—i káº¿t ná»‘i'); }
    });

    function openChangePassword() { document.getElementById('passwordModal').classList.remove('hidden'); }
    function closePasswordModal() { document.getElementById('passwordModal').classList.add('hidden'); document.getElementById('passwordForm').reset(); }

    document.getElementById('passwordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const newPassword = document.getElementById('newPassword').value;
      if (newPassword !== document.getElementById('confirmPassword').value) { alert('Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!'); return; }
      if (newPassword.length < 6) { alert('Máº­t kháº©u má»›i pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±!'); return; }
      try {
        const response = await fetch(`${API_URL}/auth/change-password`, {
          method: 'PUT', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ currentPassword: document.getElementById('currentPassword').value, newPassword })
        });
        const data = await response.json();
        if (response.ok) { alert('Äá»•i máº­t kháº©u thÃ nh cÃ´ng!'); closePasswordModal(); }
        else { alert(data.message || 'Lá»—i Ä‘á»•i máº­t kháº©u'); }
      } catch (error) { alert('Lá»—i káº¿t ná»‘i'); }
    });

    loadProfile();
    loadBookingHistory();
  </script>
</body>
</html>
